<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartSpend — Personal Finance (Dark)</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg:#161b21;
      --panel:#24303d;
      --muted:#9aa6b2;
      --accent:#6ee7b7;
      --danger:#ff7a7a;
      --glass: rgba(255,255,255,0.03);
      --card-radius: 14px;
      --max-width:1100px;
      --gap:18px;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071017 0%,#08111a 100%);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#dbe9ee}
    .wrap{max-width:var(--max-width);margin:28px auto;padding:22px;display:grid;grid-template-columns:1fr 390px;gap:var(--gap);}
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;gap:14px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#3ddfd0);display:flex;align-items:center;justify-content:center;font-weight:700;color:#022;box-shadow:0 6px 24px rgba(0,0,0,0.6)}
    h1{font-size:20px;margin:0}
    .subtitle{color:var(--muted);font-size:13px}
    .controls{display:flex;align-items:center;gap:8px}
    button{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:10px;color:inherit;cursor:pointer;backdrop-filter: blur(4px)}
    button.ghost{background:transparent;border:1px dashed rgba(255,255,255,0.04)}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:var(--card-radius);box-shadow:0 8px 30px rgba(2,6,12,0.6);border:1px solid rgba(255,255,255,0.02)}
    /* Left column layout */
    .main-col{display:grid;grid-auto-rows:min-content;gap:var(--gap)}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .spacious{padding:20px}
    .big-number{font-size:28px;font-weight:700}
    .muted{color:var(--muted);font-size:13px}
    /* Transaction list */
    .tx-list{display:flex;flex-direction:column;gap:10px}
    .tx{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:rgba(0,0,0,0.15);border:1px solid rgba(255,255,255,0.02)}
    .tx .left{display:flex;gap:12px;align-items:center}
    .badge{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700}
    .cat-Groceries{background:linear-gradient(135deg,#ffb86b,#ff9e9e);color:#2b0b00}
    .cat-Transport{background:linear-gradient(135deg,#8bd3ff,#6b8cff);color:#021124}
    .cat-Coffee{background:linear-gradient(135deg,#ffd6f2,#ffa3d6);color:#2b0024}
    .cat-Bills{background:linear-gradient(135deg,#c7f7d9,#6ee7b7);color:#01220a}
    .cat-Entertainment{background:linear-gradient(135deg,#c6b3ff,#8e7cff);color:#120a2b}
    .cat-Other{background:linear-gradient(135deg,#e2e2e2,#cfcfcf);color:#071017}
    .tx .meta{color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px}
    input,select{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:inherit}
    input[type=number]{width:130px}
    .right-col{display:flex;flex-direction:column;gap:var(--gap)}
    .chart-wrap{height:260px}
    .collapse{margin-top:8px}
    .collapser{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .footer{grid-column:1/-1;margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
    /* responsive */
    @media (max-width:980px){.wrap{grid-template-columns:1fr;padding:16px} .right-col{order:2} .main-col{order:1}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">SS</div>
        <div>
          <h1>SmartSpend</h1>
          <div class="subtitle">Personal finance tracker.</div>
        </div>
      </div>

      <div class="controls">
        <button id="exportBtn">Export JSON</button>
        <label for="importFileBtn" style="display:inline-block"><button class="ghost">Import</button></label>
        <input id="importFileBtn" type="file" accept="application/json" style="display:none">
        <button id="resetBtn" title="Clear all local data">Reset</button>
      </div>
    </header>

    <!-- left -->
    <div class="main-col">
      <!-- Overview -->
      <div class="panel grid-2 spacious">
        <div>
          <div class="muted">Monthly income</div>
          <div class="big-number" id="totalIncome">—</div>
        </div>
        <div>
          <div class="muted">Monthly expenses</div>
          <div class="big-number" id="totalExpense">—</div>
          <div class="muted">Remaining: <span id="remaining">—</span></div>
        </div>
      </div>

      <!-- Input forms (collapsible) -->
      <div class="panel">
        <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
          <strong>Add transaction</strong>
          <small class="muted">Tip: Add recurring bills as monthly transactions.</small>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <select id="catSelect" aria-label="Category">
            <option value="">Select category</option>
            <option>Groceries</option>
            <option>Transport</option>
            <option>Coffee</option>
            <option>Bills</option>
            <option>Entertainment</option>
            <option>Other</option>
          </select>

          <input id="desc" placeholder="Description (eg. Phone bill)" />

          <input id="amount" type="number" placeholder="Amount" />

          <input id="date" type="date" style="min-width:160px"/>

          <select id="type">
            <option value="expense">Expense</option>
            <option value="income">Income</option>
          </select>

          <button id="addBtn">Add</button>
        </div>
      </div>

      <!-- Transaction list -->
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Transactions</strong>
          <div class="muted">You can edit/delete entries</div>
        </div>
        <div style="margin-top:12px" class="tx-list" id="txList">
          <!-- dynamically filled -->
        </div>
      </div>

      <!-- Detailed charts -->
      <div class="panel">
        <strong>Monthly breakdown</strong>
        <div class="muted">Spending by category + timeline</div>
        <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:260px" class="chart-wrap panel" id="pieCard">
            <canvas id="pieChart"></canvas>
          </div>
          <div style="flex:1;min-width:260px" class="chart-wrap panel" id="barCard">
            <canvas id="barChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- right -->
    <aside class="right-col">
      <div class="panel">
        <strong>Quick stats</strong>
        <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
          <div style="display:flex;justify-content:space-between"><div class="muted">Transactions</div><div id="statCount">0</div></div>
          <div style="display:flex;justify-content:space-between"><div class="muted">Avg. spend</div><div id="statAvg">—</div></div>
          <div style="display:flex;justify-content:space-between"><div class="muted">Largest expense</div><div id="statMax">—</div></div>
        </div>
      </div>

      <div class="panel">
        <strong>Filters & view</strong>
        <div style="margin-top:12px;display:flex;gap:8px;flex-direction:column">
          <select id="filterCat"><option value="">All categories</option>
            <option>Groceries</option><option>Transport</option><option>Coffee</option><option>Bills</option><option>Entertainment</option><option>Other</option>
          </select>
          <select id="filterType"><option value="">All types</option><option value="expense">Expense</option><option value="income">Income</option></select>
          <div style="display:flex;gap:8px">
            <input id="fromDate" type="date" />
            <input id="toDate" type="date" />
          </div>
          <button id="applyFilter">Apply</button>
          <button id="clearFilter" class="ghost">Clear</button>
        </div>
      </div>

      <div class="panel">
        <strong>Export / Import</strong>
        <div class="muted" style="margin-top:8px">Move your data between devices or save a backup.</div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="exportBtn2">Download</button>
          <button id="importBtn2" class="ghost">Upload</button>
        </div>
      </div>

    </aside>

    <div class="footer panel" style="margin-top:18px">
      <div style="max-width:900px;margin:0 auto">
        SmartSpend — your personal finance tracker. Built for clarity and speed.
      </div>
    </div>
  </div>

<script>
/* ======= Data model & persistence ======= */
const STORAGE_KEY = 'smartspend.v1';
let state = { items: [] }; // item = {id, type:'income'|'expense', category, description, amount:number, date: ISO}

function load() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    state = raw ? JSON.parse(raw) : { items: [] };
  } catch (e) {
    console.error('load', e);
    state = { items: [] };
  }
}
function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

/* ======= utilities ======= */
const $ = id => document.getElementById(id);
const fmt = n => (typeof n==='number' ? n.toLocaleString(undefined,{maximumFractionDigits:2}) : n);

/* ======= render / summary ======= */
function calcSummary(items) {
  const income = items.filter(i=>i.type==='income').reduce((s,i)=>s+Number(i.amount),0);
  const expense = items.filter(i=>i.type==='expense').reduce((s,i)=>s+Number(i.amount),0);
  const remaining = income - expense;
  const count = items.length;
  const avg = count ? (expense / Math.max(1, items.filter(i=>i.type==='expense').length)) : 0;
  const max = items.filter(i=>i.type==='expense').sort((a,b)=>b.amount-a.amount)[0];
  return { income, expense, remaining, count, avg, max: max ? `${max.description} — ${fmt(max.amount)}` : '—' };
}

function getCategoryTotals(items) {
  const map = {};
  for (const it of items.filter(i=>i.type==='expense')) {
    map[it.category = it.category || 'Other'] = (map[it.category]||0) + Number(it.amount);
  }
  return map;
}

/* ======= UI updates ======= */
function renderAll(filter) {
  const items = applyFilter(state.items, filter);
  const s = calcSummary(items);
  $('totalIncome').textContent = s.income? '₹' + fmt(s.income) : '—';
  $('totalExpense').textContent = s.expense? '₹' + fmt(s.expense) : '—';
  $('remaining').textContent = '₹' + fmt(s.remaining);
  $('statCount').textContent = s.count;
  $('statAvg').textContent = s.avg ? '₹' + fmt(s.avg) : '—';
  $('statMax').textContent = s.max;

  // transactions list (most recent first)
  const list = $('txList');
  list.innerHTML = '';
  const sorted = [...items].sort((a,b)=>new Date(b.date)-new Date(a.date));
  if (sorted.length===0) {
    list.innerHTML = `<div class="muted">No transactions yet — add your first one using the form above.</div>`;
  } else {
    for (const it of sorted) {
      const el = document.createElement('div');
      el.className = 'tx';
      el.innerHTML = `
        <div class="left">
          <div class="badge cat-${escapeClass(it.category||'Other')}">${(it.category||'Other').charAt(0)}</div>
          <div>
            <div style="font-weight:600">${escapeHtml(it.description||it.category||'—')}</div>
            <div class="meta">${new Date(it.date).toLocaleDateString()} • ${escapeHtml(it.category||'Other')}</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:center">
          <div style="text-align:right">
            <div style="font-weight:700">${it.type==='income' ? '+' : '-'} ₹${fmt(Number(it.amount))}</div>
          </div>
          <div class="actions">
            <button onclick="editItem('${it.id}')">Edit</button>
            <button onclick="deleteItem('${it.id}')" style="background:var(--danger)">Delete</button>
          </div>
        </div>
      `;
      list.appendChild(el);
    }
  }

  // charts
  updateCharts(items);
  save();
}

/* helpers for safe class names and escaping */
function escapeClass(s){ return String(s).replace(/\s+/g,'-').replace(/[^a-zA-Z0-9\-_]/g,''); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

/* ======= CRUD ======= */
function addItem(data) {
  state.items.push({...data, id: Date.now().toString(36)});
  renderAll(currentFilter);
}
function updateItem(id, patch) {
  const i = state.items.find(x=>x.id===id);
  if (i) Object.assign(i, patch);
  renderAll(currentFilter);
}
function deleteItem(id) {
  if (!confirm('Delete this entry?')) return;
  state.items = state.items.filter(x=>x.id!==id);
  renderAll(currentFilter);
}
function editItem(id) {
  const it = state.items.find(x=>x.id===id);
  if (!it) return alert('Item not found');
  // quick inline edit prompt (keeps UI simple)
  const desc = prompt('Description', it.description||'') ; if (desc===null) return;
  const amount = prompt('Amount', it.amount); if (amount===null) return;
  const date = prompt('Date (yyyy-mm-dd)', it.date.slice(0,10)); if (date===null) return;
  const cat = prompt('Category', it.category||'Other'); if (cat===null) return;
  updateItem(id, { description: desc, amount: Number(amount)||0, date: new Date(date).toISOString(), category: cat });
}

/* ======= Filters ======= */
let currentFilter = null;
function applyFilter(items, f) {
  f = f || currentFilter;
  if (!f) return items;
  return items.filter(it=>{
    if (f.type && it.type!==f.type) return false;
    if (f.category && it.category!==f.category) return false;
    if (f.fromDate && new Date(it.date) < new Date(f.fromDate)) return false;
    if (f.toDate && new Date(it.date) > new Date(f.toDate)) return false;
    return true;
  });
}

/* ======= Charts (Chart.js) ======= */
let pieChart, barChart;
function updateCharts(items) {
  // pie: category totals
  const catTotals = getCategoryTotals(items);
  const labels = Object.keys(catTotals);
  const data = labels.map(l=>catTotals[l]);
  const bg = labels.map((l,i)=>palette(i, labels.length));
  if (!pieChart) {
    const ctx = $('pieChart').getContext('2d');
    pieChart = new Chart(ctx, {
      type:'pie',
      data:{labels, datasets:[{data, backgroundColor:bg}]},
      options:{plugins:{legend:{position:'bottom',labels:{color:'#cfeff6'}}}}
    });
  } else {
    pieChart.data.labels = labels;
    pieChart.data.datasets[0].data = data;
    pieChart.data.datasets[0].backgroundColor = bg;
    pieChart.update();
  }

  // bar: timeline (monthly totals for last 6 months)
  const byMonth = {};
  const now = new Date();
  for (let i=5;i>=0;i--){
    const d = new Date(now.getFullYear(), now.getMonth()-i, 1);
    const key = d.toLocaleString(undefined,{month:'short',year:'numeric'});
    byMonth[key] = 0;
  }
  for (const it of items.filter(i=>i.type==='expense')) {
    const key = new Date(it.date).toLocaleString(undefined,{month:'short',year:'numeric'});
    if (key in byMonth) byMonth[key] += Number(it.amount);
  }
  const barLabels = Object.keys(byMonth);
  const barData = barLabels.map(k=>byMonth[k]);
  if (!barChart) {
    const ctx = $('barChart').getContext('2d');
    barChart = new Chart(ctx, {
      type:'bar',
      data:{labels:barLabels, datasets:[{label:'Expenses',data:barData,backgroundColor:'#ff8a65'}]},
      options:{scales:{y:{ticks:{color:'#cfeff6'}}},plugins:{legend:{display:false}}}
    });
  } else {
    barChart.data.labels = barLabels;
    barChart.data.datasets[0].data = barData;
    barChart.update();
  }
}

/* small palette function — reproducible set of colors */
function palette(i,n){
  const base = [
    '#6ee7b7','#8bd3ff','#ffb86b','#ffd6f2','#c7f7d9','#c6b3ff','#f9c07d','#9be6ff','#ffd1b8'
  ];
  return base[i % base.length];
}

/* ======= export / import / reset ======= */
function exportData() {
  const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'smartspend-data.json'; document.body.appendChild(a); a.click();
  setTimeout(()=>{URL.revokeObjectURL(url); a.remove();},500);
}
function importDataFile(file) {
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const parsed = JSON.parse(reader.result);
      if (parsed && Array.isArray(parsed.items)) {
        state = parsed; save(); renderAll(); alert('Imported successfully');
      } else throw new Error('Invalid file');
    } catch (e) { alert('Import failed: ' + e.message); }
  };
  reader.readAsText(file);
}
function resetAll() {
  if (!confirm('Clear all saved data? This cannot be undone.')) return;
  state = { items: [] }; save(); renderAll();
}

/* ======= UI wiring ======= */
document.addEventListener('DOMContentLoaded', ()=>{
  load(); renderAll();

  $('addBtn').addEventListener('click', ()=>{
    const cat = $('catSelect').value || 'Other';
    const desc = $('desc').value.trim() || cat;
    const amt = Number($('amount').value) || 0;
    const date = $('date').value ? new Date($('date').value).toISOString() : new Date().toISOString();
    const type = $('type').value;
    if (!amt || !desc) return alert('Please enter description and amount');
    addItem({ type, category:cat, description:desc, amount: amt, date });
    // clear lightweight
    $('amount').value = ''; $('desc').value=''; $('date').value='';
  });

  $('exportBtn').addEventListener('click', exportData);
  $('exportBtn2').addEventListener('click', exportData);

  $('importFileBtn').addEventListener('change', (e)=>{ if (e.target.files[0]) importDataFile(e.target.files[0]); e.target.value=''; });
  $('importBtn2').addEventListener('click', ()=>$('importFileBtn').click());

  $('resetBtn').addEventListener('click', resetAll);

  // filters
  $('applyFilter').addEventListener('click', ()=>{
    const f = {
      category: $('filterCat').value || null,
      type: $('filterType').value || null,
      fromDate: $('fromDate').value || null,
      toDate: $('toDate').value || null
    };
    if (!f.category && !f.type && !f.fromDate && !f.toDate) { currentFilter = null; } else currentFilter = f;
    renderAll(currentFilter);
  });
  $('clearFilter').addEventListener('click', ()=>{
    $('filterCat').value=''; $('filterType').value=''; $('fromDate').value=''; $('toDate').value='';
    currentFilter=null; renderAll();
  });
});

/* ======= small convenience for console debugging ======= */
window._smartspend = { getState: ()=>state, reset: resetAll, exportData };

/* ======= quick-delete helpers used inline ======= */
function deleteItemWrapper(id){ deleteItem(id); }
function editItemWrapper(id){ editItem(id); }

/* make functions accessible for inline onclick generated above */
window.deleteItem = deleteItem;
window.editItem = editItem;

</script>
</body>
</html>
